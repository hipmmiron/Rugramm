<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Rugramm</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/beercss@3.5.1/dist/cdn/beer.min.css" rel="stylesheet">
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.5.1/dist/cdn/beer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    
    <style>
        /* Базовые исправления */
        body { font-family: 'Roboto', sans-serif; height: 100vh; margin: 0; overflow: hidden; background: var(--surface); }
        
        /* Жестко фиксируем левую панель */
        .drawer.left { 
            width: 320px !important; 
            min-width: 320px !important;
            height: 100vh !important;
            border-radius: 0 32px 32px 0 !important; 
            display: flex;
            flex-direction: column;
            position: relative !important; /* Убираем наложение на чат */
            z-index: 10;
        }

        /* Контент чата справа */
        .main-content { 
            flex: 1 !important;
            height: 100vh !important; 
            display: flex !important; 
            flex-direction: column !important; 
            overflow: hidden !important; 
            min-width: 0 !important;
        }

        /* Область сообщений */
        #messages { 
            flex: 1; 
            background: var(--surface-container-lowest); 
            border-radius: 32px; 
            margin: 0 16px 8px 16px; 
            overflow-y: auto; 
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Аватарка */
        .user-avatar-container { width: 56px; height: 56px; overflow: hidden; flex-shrink: 0; }
        .user-avatar { width: 100%; height: 100%; object-fit: cover; }
        
        /* Футер и фикс fffff */
        footer { padding: 8px 16px 16px 16px; width: 100%; box-sizing: border-box; }
        
        #msg, .field input {
            flex: 1 !important;
            min-width: 0 !important;
            word-break: break-all !important; 
        }

        /* Чтобы сообщения не улетали за край */
        .msg-row { max-width: 80%; word-wrap: break-word; margin-bottom: 8px; }
        
        /* Активный чат в списке */
        .row.padding.round.active { background-color: var(--primary-container); }
    </style>
</head>
<body class="light">
    <div class="row no-space" style="height: 100vh;">
        
        <nav class="drawer left active">
            <header class="row padding no-wrap middle-align">
                <div class="circle user-avatar-container primary shadow">
                    {% if avatar %}
                        <img class="user-avatar" src="{{ avatar }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                    {% endif %}
                    <i class="white-text" style="{% if avatar %}display:none;{% else %}display:flex;{% endif %}">person</i>
                </div>
                <div class="max padding">
                    <h6 class="no-margin bold">{{ username }}</h6>
                    <p class="small no-margin primary-text">В сети</p>
                </div>
            </header>

            <div class="field prefix round fill margin">
                <i>search</i>
                <input id="search" placeholder="Поиск друзей...">
            </div>
            
            <div id="friendList" class="scroll max">
                <div class="center-align padding opacity-60">
                    <p class="small">Ваши контакты появятся здесь</p>
                </div>
            </div>

            <div class="divider"></div>
            <a class="row padding round" href="/logout">
                <i>logout</i>
                <span>Выйти</span>
            </a>
        </nav>

        <main class="main-content">
            <header class="padding">
                <div class="row middle-align">
                    <h5 id="currentTitle" class="max bold">Выберите чат</h5>
                    <button class="circle transparent" onclick="ui('theme', ui('theme')=='dark'?'light':'dark')">
                        <i>brightness_medium</i>
                    </button>
                </div>
            </header>

            <div id="messages" class="shadow">
                <div class="center-align middle-align" style="margin: auto; opacity:0.4">
                    <i class="extra">chat</i>
                    <p>Выберите, кому написать</p>
                </div>
            </div>

            <footer>
                <div class="field middle-align no-margin round fill">
                    <input id="msg" placeholder="Напишите сообщение...">
                    <button id="send" class="circle primary">
                        <i>send</i>
                    </button>
                </div>
            </footer>
        </main>
    </div>

    <script>
        window.myId = "{{ session.get('user_id', '') }}"; 
        console.log("Rugramm запущен. Ваш ID:", window.myId);
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>